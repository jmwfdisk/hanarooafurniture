<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜ - ë‚©í’ˆí•™êµ ë¦¬ìŠ¤íŠ¸">
    <meta name="keywords" content="í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜, ë‚©í’ˆí•™êµ, í•™êµ ë¦¬ìŠ¤íŠ¸">
    <title>í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜ ë‚©í’ˆí•™êµ ë¦¬ìŠ¤íŠ¸</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì—‘ì…€ íŒŒì¼ ì½ê¸°ìš©) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- Tabulator.js ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë·°ìš©) - ë¡œì»¬ íŒŒì¼ ì‚¬ìš© -->
    <link href="lib/tabulator/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="lib/tabulator/tabulator.min.js"></script>
    
    <!-- ê³µí†µ ì¸ì¦ CSS -->
    <link rel="stylesheet" href="../css/auth.css">
    <!-- ê³µí†µ ë””ìì¸ ì‹œìŠ¤í…œ CSS -->
    <link rel="stylesheet" href="../css/common.css">
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #ffffff;
            color: #000000;
            text-align: center;
        }

        .navbar {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 5px 5px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            height: 78px;
            transition: all 0.3s ease;
            flex-wrap: wrap;
        }
        
        .navbar > div {
            transition: all 0.3s ease;
        }


        .navbar > .logo {
            margin-right: auto;
        }
        
        .navbar .logo a {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #000;
        }
        
        .navbar .logo img {
            height: 50px;
            overflow: visible;
        }
        
        .navbar .logo a {
            display: block;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        
        .navbar .logo a:hover {
            opacity: 0.8;
        }
        
        .navbar .logo span {
            font-size: 18px;
            font-weight: bold;
            white-space: nowrap;
        }

        .navbar > div {
            position: relative;
        }

        .navbar > div > a {
            margin: 13px 4px !important;
            font-size: 18px !important;
            font-weight: 600;
            letter-spacing: -0.5px;
            text-decoration: none;
            color: #212529;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            white-space: nowrap;
            position: relative;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .navbar > div > a:hover {
            color: #44aa6b;
            background: rgba(68, 170, 107, 0.08);
        }

        .body {
            overflow-x: auto;
        }

        footer {
            background-color: #ccc8c8;
            color: #696868;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            padding-bottom: 15px;
        }

        footer p {
            font-size: 13px;
            margin: 8px 0;
            line-height: 1.5;
        }

        footer p1 {
            font-size: 13px;
            text-align: left;
        }

        footer::before {
            content: "";
            display: block;
            width: 68%;
            margin: 0 auto;
            border-top: 1px solid #ccc;
            margin-bottom: 10px;
        }

        .footer-top {
            display: flex;
            justify-content: flex-end;
            align-items: flex-end;
            background-color: #ffffff;
            color: #ffffff;
            padding: 5px;
            font-size: 12px;
            gap: 10px;
        }

        .footer-top button:disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
        }

        .footer-top button {
            background-color: #ffffff;
            color: #7a7878;
            border: none;
            cursor: pointer;
            font-size: 12px;
            padding: 5px 5px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-top button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        .footer-top button img {
            height: 16px;
            width: 16px;
        }

        .partner-logos {
            display: flex !important;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px 20px !important;
            margin: 0 !important;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: relative !important;
            z-index: 10 !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100% !important;
            min-height: 100px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }
        
        .partner-logos-wrapper {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .partner-logos a {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            min-width: 40px;
            background: #ffffff !important;
            border-radius: 12px;
            padding: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: visible !important;
            flex-shrink: 0;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .partner-logos a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(68, 170, 107, 0.1) 0%, rgba(58, 143, 90, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .partner-logos a:hover {
            transform: translateY(-4px) scale(1.15);
            box-shadow: 0 6px 20px rgba(68, 170, 107, 0.25);
        }
        
        .partner-logos a:hover::before {
            opacity: 1;
        }

        .partner-logos img {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            object-fit: contain !important;
            border-radius: 6px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .partner-logos a:hover img {
            transform: scale(1.2);
        }

        /* ì—‘ì…€ ë°ì´í„° í‘œì‹œ ì˜ì—­ */
        .excel-display-area {
            margin-top: 0;
            padding: 20px;
            background: #fff;
            position: relative;
            z-index: 1;
            overflow: visible !important;
            max-height: none !important;
            height: auto !important;
            margin-bottom: 40px !important; /* íŒŒíŠ¸ë„ˆ ë¡œê³ ì™€ì˜ ê°„ê²© í™•ë³´ */
        }
        
        /* ì—‘ì…€ ì˜ì—­ì´ íŒŒíŠ¸ë„ˆ ë¡œê³ ë¥¼ ê°€ë¦¬ì§€ ì•Šë„ë¡ */
        #excel-display-area {
            position: relative !important;
            z-index: 1 !important;
            margin-bottom: 40px !important; /* íŒŒíŠ¸ë„ˆ ë¡œê³ ì™€ì˜ ê°„ê²© í™•ë³´ */
            padding-bottom: 30px;
        }
        
        /* íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ í•­ìƒ í‘œì‹œë˜ë„ë¡ ê°•ì œ - ìµœìš°ì„  ì ìš© */
        div.partner-logos,
        .partner-logos {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1000 !important;
            clear: both !important;
            margin-top: 40px !important;
            margin-bottom: 20px !important;
            height: auto !important;
            min-height: 100px !important;
            max-height: none !important;
            width: 100% !important;
            box-sizing: border-box !important;
            overflow: visible !important;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            padding: 20px 20px !important;
            border-top: 1px solid rgba(0, 0, 0, 0.05) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
        }
        
        /* íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ ì ˆëŒ€ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡ ìµœì¢… ë³´í˜¸ */
        body .partner-logos,
        html .partner-logos {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .read-only-notice {
            padding: 10px 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .hamburger { 
            display: none; 
            background: transparent; 
            border: 0; 
            padding: 8px; 
            cursor: pointer; 
            position: relative;
            width: 28px;
            height: 24px;
        }
        .hamburger .bar { 
            display: block; 
            width: 22px; 
            height: 2px; 
            margin: 4px 0; 
            background: #000; 
            transition: transform 0.3s, opacity 0.3s; 
        }
        .mobile-drawer { display: none !important; }

        .login {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-direction: row;
        }

        /* ìˆ¨ê²¨ì§„ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì´ ê³µê°„ì„ ì°¨ì§€í•˜ì§€ ì•Šë„ë¡ */
        .login-item[style*="display: none"],
        #login-link[style*="display: none"],
        #logout-link[style*="display: none"] {
            display: none !important;
            width: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
        }

        .login-item {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .employee-btn {
            display: flex;
            align-items: center;
        }
        
        .employee-btn button {
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .employee-btn button:not(:disabled) {
            background: linear-gradient(135deg, #44aa6b 0%, #3a8f5a 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(68, 170, 107, 0.3);
        }

        .employee-btn button:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(68, 170, 107, 0.4);
        }

        .employee-btn button:disabled {
            background-color: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
        }

        .login-icon {
            height: 20px;
            width: auto;
            margin-right: 5px;
            vertical-align: middle;
        }

        .navbar > .logo {
            margin-right: auto;
        }

        /* ì—‘ì…€ ì—…ë¡œë“œ ë²„íŠ¼ (ê´€ë¦¬ìë§Œ) - ë™ê·¸ë€ ì˜¤ë²„ë ˆì´ ë²„íŠ¼ */
        .excel-upload-btn {
            position: fixed;
            top: 150px;
            right: 30px;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #44aa6b 0%, #3a8f5a 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(68, 170, 107, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            overflow: hidden;
            line-height: 1.2;
            text-align: center;
            padding: 0;
        }

        .excel-upload-btn[style*="display: block"] {
            display: flex !important;
        }

        .excel-upload-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(68, 170, 107, 0.5);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .excel-upload-btn::before {
            content: 'íŒŒì¼\Aì²¨ë¶€';
            white-space: pre;
            font-size: 10px;
            line-height: 1.2;
            text-align: center;
        }

        .excel-upload-btn input[type="file"] {
            display: none;
        }

        .excel-upload-btn span {
            display: none;
        }


        /* Tabulator ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìŠ¤íƒ€ì¼ */
        #tabulator-table {
            margin: 20px 0;
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            min-height: 400px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ í…Œì´ë¸” ë†’ì´ ì œí•œ í•´ì œ ë° ê°€ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
        @media (max-width: 1024px) {
            #tabulator-table {
                min-height: 500px !important;
                height: auto !important;
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½í•˜ì—¬ ìŠ¤í¬ë¡¤ë°” í•­ìƒ í‘œì‹œ */
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            #tabulator-table .tabulator {
                min-height: 500px !important;
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½ */
                overflow-y: auto !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            /* Tabulator ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ */
            #tabulator-table .tabulator-tableHolder {
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½ */
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100% !important;
            }

            /* Tabulator í…Œì´ë¸” ë³¸ì²´ - ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡ */
            #tabulator-table .tabulator-table {
                min-width: max-content !important; /* ì»¬ëŸ¼ ë„ˆë¹„ í•©ê³„ë§Œí¼ ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
                width: max-content !important; /* ì»¬ëŸ¼ì´ ëª¨ë‘ í‘œì‹œë˜ë„ë¡ */
                table-layout: auto !important; /* ìë™ ë ˆì´ì•„ì›ƒ */
            }

            /* ëª¨ë“  ì»¬ëŸ¼ì´ í•­ìƒ í‘œì‹œë˜ë„ë¡ - ì ˆëŒ€ ì‚¬ë¼ì§€ì§€ ì•Šê²Œ ê°•ì œ */
            #tabulator-table .tabulator-col,
            #tabulator-table .tabulator-col-group,
            #tabulator-table .tabulator-header .tabulator-col {
                display: table-cell !important;
                visibility: visible !important;
                opacity: 1 !important;
                width: auto !important;
                min-width: 120px !important;
                max-width: none !important;
            }

            /* ì»¬ëŸ¼ì´ ìˆ¨ê²¨ì§€ì§€ ì•Šë„ë¡ ê°•ì œ */
            #tabulator-table .tabulator-col[style*="display: none"],
            #tabulator-table .tabulator-col[style*="visibility: hidden"] {
                display: table-cell !important;
                visibility: visible !important;
            }

            /* ì…€ í…ìŠ¤íŠ¸ ì „ì²´ í‘œì‹œ (ìŠ¤ì™€ì´í”„ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡) */
            #tabulator-table .tabulator-cell {
                white-space: nowrap !important;
                overflow: visible !important;
                text-overflow: clip !important;
                min-width: 120px !important; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
                display: table-cell !important;
                visibility: visible !important;
            }

            /* í–‰ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡ */
            #tabulator-table .tabulator-row {
                display: table-row !important;
                visibility: visible !important;
            }
        }

        .tabulator {
            font-size: 14px;
            background: #fff;
        }
        
        .tabulator-table {
            width: 100%;
        }

        .tabulator .tabulator-header {
            background: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .tabulator .tabulator-header .tabulator-col {
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }

        .tabulator .tabulator-cell {
            border-right: 1px solid #dee2e6;
            padding: 8px 12px;
        }

        .tabulator .tabulator-row {
            border-bottom: 1px solid #dee2e6;
        }

        .tabulator .tabulator-row:hover {
            background: #f8f9fa;
        }

        .tabulator .tabulator-row.tabulator-selected {
            background: #e3f2fd;
        }

        /* Tabulator íˆ´ë°” ìŠ¤íƒ€ì¼ */
        .tabulator-toolbar {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tabulator-toolbar input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            min-width: 200px;
        }

        .tabulator-toolbar button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #44aa6b 0%, #3a8f5a 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tabulator-toolbar button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(68, 170, 107, 0.3);
        }

        /* ì½ê¸° ì „ìš© í‘œì‹œ */
        .read-only-notice {
            padding: 10px 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ */
        .login-notice-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .login-notice-modal.active {
            display: flex;
        }

        .login-notice-content {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .login-notice-content h3 {
            margin: 0 0 15px;
            color: #333;
            font-size: 20px;
        }

        .login-notice-content p {
            margin: 0 0 20px;
            color: #666;
            line-height: 1.6;
        }

        .login-notice-content button {
            background: linear-gradient(135deg, #0071e3 0%, #005bb5 100%);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .login-notice-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }

        @media (max-width: 1200px) and (min-width: 1025px) {
            .navbar > div > a {
                margin: 13px 2px !important;
                font-size: 16px !important;
                padding: 8px 10px;
            }
        }

        @media (max-width: 1024px) {
            .navbar {
                display: grid;
                grid-template-columns: auto 1fr auto;
                align-items: center;
                height: 85px;
                padding: 0 8px;
                transition: all 0.3s ease;
            }

            .navbar > div {
                transition: all 0.3s ease;
            }

            .navbar .login a {
                margin: 0 !important;
            }

            .navbar .login {
                grid-column: 3;
                margin-left: auto;
                display: flex;
                flex-direction: row;
                gap: 2px;  /* ê°„ê²©ì„ 8pxì—ì„œ 2pxë¡œ ì¤„ì„ */
                align-items: center;
            }
            
            /* ë¡œê·¸ì¸ ë²„íŠ¼ë„ 30% ì‘ê²Œ */
            .login a,
            .login-item {
                font-size: 11.2px !important;  /* 30% ê°ì†Œ (ê¸°ë³¸ 16px ê¸°ì¤€) */
                padding: 4.2px 8.4px !important;  /* 30% ê°ì†Œ */
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .login-icon {
                height: 14px !important;  /* 30% ê°ì†Œ: 20px -> 14px */
                width: auto !important;
                margin-right: 3.5px !important;  /* 30% ê°ì†Œ: 5px -> 3.5px */
                display: inline-block !important;
                vertical-align: middle !important;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ë¡œê·¸ì•„ì›ƒ íƒ€ì´ë¨¸ ìˆ¨ê¹€ */
            #logout-timer {
                display: none !important;
            }

            .navbar > div:not(.logo):not(.login):not(.mobile-only) {
                display: none;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì„ì§ì› ë²„íŠ¼ì„ ë„¤ë¹„ê²Œì´ì…˜ ë°” í•˜ë‹¨ì— ì§ì‚¬ê°í˜•ìœ¼ë¡œ ë°°ì¹˜ */
            .navbar .employee-btn,
            .navbar .login .employee-btn {
                position: fixed !important;
                right: 0 !important;
                top: 85px !important; /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ë†’ì´ì™€ ë™ì¼ */
                z-index: 999 !important;
                display: flex !important;
                pointer-events: auto !important;
                visibility: visible !important;
                opacity: 1 !important;
                width: auto !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 0 !important; /* ì§ì‚¬ê°í˜• */
                border: none !important;
                box-shadow: none !important;
                transition: all 0.3s ease !important;
                background: transparent !important; /* íˆ¬ëª…í•œ ë°°ê²½ ì œê±° */
            }

            .navbar .employee-btn button,
            .navbar .login .employee-btn button {
                width: auto !important;
                height: auto !important;
                padding: 8px 16px !important;
                border-radius: 0 !important; /* ì§ì‚¬ê°í˜• */
                font-size: 12px !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; /* ë‹¤ë¥¸ ìƒ‰ìƒ (ë³´ë¼ìƒ‰) */
                color: white !important;
                box-shadow: none !important;
                transition: all 0.3s ease !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border: none !important;
                line-height: 1.2 !important;
                text-align: center !important;
            }

            .navbar .employee-btn button:not(:disabled):hover,
            .navbar .login .employee-btn button:not(:disabled):hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
            }

            .navbar .employee-btn button:disabled,
            .navbar .login .employee-btn button:disabled {
                background: #e9ecef !important;
                color: #adb5bd !important;
                cursor: not-allowed !important;
                pointer-events: none !important;
            }

            .navbar .employee-btn:has(button:disabled),
            .navbar .login .employee-btn:has(button:disabled) {
                pointer-events: none !important;
            }
            .footer-top { display: none; }
            .login-icon { 
                display: inline-block !important;  /* ëª¨ë°”ì¼ì—ì„œë„ ì•„ì´ì½˜ í‘œì‹œ */
                height: 14px !important;  /* 30% ê°ì†Œëœ í¬ê¸° ìœ ì§€ */
            }
            .navbar > .logo { 
                margin-right: 0;
            }

            .hamburger {
                grid-column: 1;
                display: inline-flex;
                width: 28px;
                height: 24px;
                position: relative;
                justify-self: start;
                padding: 0;
                border: 0;
                background: transparent;
                cursor: pointer;
                z-index: 1003 !important;
                flex-shrink: 0;
                order: -1;
                align-items: center;
                justify-content: center;
                margin-right: auto;
            }

            .hamburger .bar {
                position: absolute;
                left: 0;
                right: 0;
                height: 2px;
                background: #000;
                margin: 0;
            }
            
            .hamburger .bar:nth-child(1) {
                top: 2px;
            }
            .hamburger .bar:nth-child(2) {
                top: 11px;
            }
            .hamburger .bar:nth-child(3) {
                bottom: 2px;
            }

            .navbar .logo {
                grid-column: 2;
                justify-self: start;
                align-self: center;
                position: static;
                transform: none;
                z-index: 1;
                margin-top: 0;
                margin-left: 0;
                margin-right: auto;
            }

            .navbar .logo img {
                height: 44px;
                overflow: visible;
            }
            
            .navbar .logo span {
                font-size: 14px !important;
                font-weight: bold;
            }

            .navbar > div:not(.logo):not(.login):not(.mobile-only) { display: none; }

            .mobile-drawer {
                position: fixed;
                top: 59px;
                left: 0;
                width: 80%;
                max-width: 340px;
                height: calc(100vh - 59px);
                background: #fff;
                box-shadow: 2px 0 12px rgba(0,0,0,0.15);
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                display: flex !important;
                flex-direction: column;
                padding: 16px 20px;
                gap: 8px;
                z-index: 1001;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .mobile-drawer a {
                padding: 12px 0;
                border-bottom: 1px solid #eee;
                text-align: left;
                font-weight: bold;
                color: #000;
                text-decoration: none;
            }

            .mobile-drawer.open { transform: translateX(0); }

            .body.menu-open { overflow: hidden; }
            .overlay.menu-open { display: block !important; }

            /* ëª¨ë°”ì¼ ì—‘ì…€ í‘œì‹œ ì˜ì—­ ìµœì í™” */
            .excel-display-area {
                padding: 10px 8px;
                margin-top: 60px !important; /* ì„ì§ì› ë²„íŠ¼ê³¼ íŒŒì¼ì²¨ë¶€ ë²„íŠ¼ ê³µê°„ í™•ë³´ */
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
            }

            /* ì½ê¸° ì „ìš© ì•Œë¦¼ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
            .read-only-notice {
                padding: 8px 12px;
                font-size: 12px;
                margin-bottom: 12px;
                border-left-width: 3px;
            }

            /* Tabulator í…Œì´ë¸” ëª¨ë°”ì¼ ìµœì í™” */
            #tabulator-table {
                margin: 10px 0;
                border-radius: 4px;
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½í•˜ì—¬ ìŠ¤í¬ë¡¤ë°” í•­ìƒ í‘œì‹œ */
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                min-height: 500px !important; /* ë” ë§ì€ í–‰ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ ë†’ì´ ì¦ê°€ */
                width: 100% !important;
                max-width: 100% !important;
                position: relative;
                /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
                scrollbar-width: thin; /* Firefox */
                scrollbar-color: #cbd5e0 #f7fafc; /* Firefox */
            }

            /* Webkit ë¸Œë¼ìš°ì € (Chrome, Safari) ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
            #tabulator-table::-webkit-scrollbar {
                height: 8px; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ë†’ì´ */
                width: 8px; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ */
            }

            #tabulator-table::-webkit-scrollbar-track {
                background: #f7fafc;
                border-radius: 4px;
            }

            #tabulator-table::-webkit-scrollbar-thumb {
                background: #cbd5e0;
                border-radius: 4px;
            }

            #tabulator-table::-webkit-scrollbar-thumb:hover {
                background: #a0aec0;
            }

            /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ê°€ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
            #tabulator-table .tabulator {
                font-size: 11px !important;
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½ */
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100% !important;
                min-width: 100% !important;
                max-width: 100% !important;
            }

            /* Tabulator í…Œì´ë¸” ë³¸ì²´ ê°€ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
            #tabulator-table .tabulator-tableHolder {
                overflow-x: scroll !important; /* scrollë¡œ ë³€ê²½ */
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
                width: 100% !important;
            }

            /* Tabulator í…Œì´ë¸” ë³¸ì²´ - ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡ */
            #tabulator-table .tabulator-table {
                min-width: max-content !important; /* ì»¬ëŸ¼ ë„ˆë¹„ í•©ê³„ë§Œí¼ ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
                width: max-content !important; /* ì»¬ëŸ¼ì´ ëª¨ë‘ í‘œì‹œë˜ë„ë¡ */
            }

            /* Tabulator ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
            #tabulator-table .tabulator-tableHolder::-webkit-scrollbar {
                height: 8px;
                width: 8px;
            }

            #tabulator-table .tabulator-tableHolder::-webkit-scrollbar-track {
                background: #f7fafc;
                border-radius: 4px;
            }

            #tabulator-table .tabulator-tableHolder::-webkit-scrollbar-thumb {
                background: #cbd5e0;
                border-radius: 4px;
            }

            #tabulator-table .tabulator-tableHolder::-webkit-scrollbar-thumb:hover {
                background: #a0aec0;
            }

            .tabulator .tabulator-header {
                font-size: 11px !important;
            }

            .tabulator .tabulator-header .tabulator-col {
                padding: 6px 4px !important;
                font-weight: 600;
                min-width: 120px !important; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
                display: table-cell !important;
                visibility: visible !important;
                opacity: 1 !important;
                width: auto !important;
                max-width: none !important;
            }

            /* ì»¬ëŸ¼ì´ ìˆ¨ê²¨ì§€ì§€ ì•Šë„ë¡ ê°•ì œ */
            .tabulator .tabulator-header .tabulator-col[style*="display: none"],
            .tabulator .tabulator-header .tabulator-col[style*="visibility: hidden"] {
                display: table-cell !important;
                visibility: visible !important;
            }

            .tabulator .tabulator-cell {
                padding: 6px 4px !important;
                font-size: 11px !important;
                white-space: nowrap !important; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
                overflow: visible !important; /* ì˜ë¦¼ ë°©ì§€ */
                text-overflow: clip !important; /* ë§ì¤„ì„í‘œ ì œê±°í•˜ì—¬ ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ */
                min-width: 120px !important; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
                display: table-cell !important;
                visibility: visible !important;
            }

            .tabulator .tabulator-row {
                min-height: 36px !important; /* í–‰ ë†’ì´ ì•½ê°„ ì¦ê°€ */
                height: 36px !important;
            }

            /* Tabulator íˆ´ë°” ëª¨ë°”ì¼ ìµœì í™” */
            .tabulator-toolbar {
                padding: 10px 8px;
                flex-direction: column;
                gap: 8px;
            }

            .tabulator-toolbar input[type="text"] {
                padding: 6px 10px;
                font-size: 12px;
                min-width: 100%;
                width: 100%;
                box-sizing: border-box;
            }

            .tabulator-toolbar button {
                padding: 6px 12px;
                font-size: 12px;
                width: 100%;
            }

            /* Tabulator í˜ì´ì§€ë„¤ì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            .tabulator .tabulator-footer {
                padding: 8px;
                font-size: 11px;
            }

            .tabulator .tabulator-footer .tabulator-paginator {
                flex-wrap: wrap;
                gap: 4px;
            }

            .tabulator .tabulator-footer .tabulator-paginator button {
                padding: 4px 8px;
                font-size: 11px;
                min-width: 32px;
            }

            .tabulator .tabulator-footer .tabulator-paginator .tabulator-page-size {
                padding: 4px 6px;
                font-size: 11px;
            }

            /* ì—‘ì…€ ì—…ë¡œë“œ ë²„íŠ¼ ëª¨ë°”ì¼ ìœ„ì¹˜ ì¡°ì • (ì„ì§ì› ë²„íŠ¼ ì•„ë˜, ë„¤ë¹„ê²Œì´ì…˜ ë°” í•˜ë‹¨) */
            .excel-upload-btn {
                position: fixed !important;
                top: auto !important;
                bottom: auto !important;
                right: 0 !important;
                left: auto !important;
                margin-top: 0 !important;
                /* ì„ì§ì› ë²„íŠ¼ ì•„ë˜ì— ë°°ì¹˜í•˜ê¸° ìœ„í•´ ê³„ì‚° */
                top: calc(85px + 35px) !important; /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ë†’ì´ + ì„ì§ì› ë²„íŠ¼ ë†’ì´ */
                width: auto !important;
                height: auto !important;
                border-radius: 0 !important;
                padding: 8px 16px !important;
                font-size: 12px !important;
                border: none !important;
                box-shadow: 0 2px 8px rgba(68, 170, 107, 0.3) !important;
                z-index: 998 !important; /* ì„ì§ì› ë²„íŠ¼(z-index: 999)ë³´ë‹¤ ë‚®ê²Œ */
            }

            .excel-upload-btn::before {
                content: 'ğŸ“ íŒŒì¼ì²¨ë¶€' !important;
                white-space: normal !important;
                font-size: 12px !important;
                line-height: 1.2 !important;
            }

            .excel-upload-btn:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 12px rgba(68, 170, 107, 0.4) !important;
            }


            .excel-table {
                font-size: 11px;
            }

            .excel-table th,
            .excel-table td {
                padding: 6px 4px;
            }

            footer { 
                padding: 14px 12px 18px;
            }
            footer::before{
                width: 90%;
                margin-bottom: 10px;
            }
            footer p, footer .footer-info{
                font-size: 10px;
                line-height: 1.35;
                letter-spacing: 0;
                text-align: left;
                margin: 4px 0;
            }
            
            .partner-logos {
                gap: 16px;
                padding: 25px 15px;
            }
            
            .partner-logos a {
                width: 35px;
                height: 35px;
                min-width: 35px;
                padding: 6px;
            }
            
            .partner-logos {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .partner-logos img {
                max-width: 100%;
                max-height: 100%;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ í‘¸í„° ë¬¸êµ¬ ì¤„ê°„ê²© ì¡°ì • */
            div[style*="padding: 15px 20px 5px 20px"] {
                padding: 15px 20px 10px 20px !important;
            }
            
            div[style*="padding: 15px 20px 5px 20px"] p {
                margin: 12px 0 !important;
                line-height: 1.8 !important;
            }

            /* ì—‘ì…€ ì—…ë¡œë“œ ë²„íŠ¼ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ì€ ì•„ë˜ì—ì„œ ì •ì˜ */


            .excel-table {
                font-size: 12px;
            }

            .excel-table th,
            .excel-table td {
                padding: 6px 8px;
            }
        }
    </style>
</head>

    <body>
    <div class="overlay" id="overlay"></div>

    <div class="login-container" id="login-container">
        <!-- íƒ­ ë²„íŠ¼ -->
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="showAuthTab('login')">ë¡œê·¸ì¸</button>
            <button class="auth-tab" onclick="showAuthTab('register')">íšŒì›ê°€ì…</button>
        </div>
        
        <!-- ë¡œê·¸ì¸ í¼ -->
        <div id="login-form" class="auth-form">
        <input type="text" id="username" placeholder="ì•„ì´ë””">
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button onclick="login()">ë¡œê·¸ì¸</button>
        </div>
        
        <!-- íšŒì›ê°€ì… í¼ -->
        <div id="register-form" class="auth-form" style="display: none;">
            <input type="text" id="reg-username" placeholder="ì•„ì´ë”” (4ì ì´ìƒ)">
            <input type="password" id="reg-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">
            <input type="password" id="reg-password-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <input type="text" id="reg-name" placeholder="ì´ë¦„">
            <input type="email" id="reg-email" placeholder="ì´ë©”ì¼">
            <input type="tel" id="reg-phone" placeholder="ì—°ë½ì²˜">
            <select id="reg-user-type" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                <option value="general">ì¼ë°˜íšŒì›</option>
                <option value="employee">ì„ì§ì›</option>
            </select>
            <button onclick="register()">íšŒì›ê°€ì… ì‹ ì²­</button>
            <p class="auth-notice">* íšŒì›ê°€ì… í›„ ê´€ë¦¬ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <header class="navbar">
      <button class="hamburger" id="hamburger" aria-label="ë©”ë‰´ ì—´ê¸°" aria-controls="mobile-nav" aria-expanded="false">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
      </button>

        <div class="logo">
            <a href="../../index.html" style="display: block; text-decoration: none;">
                <img src="../image/logo-nav.png" alt="ë¡œê³ " style="height: 50px; overflow: visible;">
            </a>
        </div>

      <nav id="mobile-nav" class="mobile-drawer" role="navigation" aria-label="ëª¨ë°”ì¼ ë©”ë‰´">
          <a href="../../index.html">í™ˆ</a>
          <a href="../company/company.html">íšŒì‚¬ì†Œê°œ</a>
          <a href="../product/product.html">ì œí’ˆì†Œê°œ</a>
          <a href="../school/school.html">ë‚©í’ˆí•™êµ ë¦¬ìŠ¤íŠ¸</a>
          <a href="../Gallery/Gallery.html">ê°¤ëŸ¬ë¦¬</a>
          <a href="../AS/AS.html">A/Sì‹ ì²­</a>
          <a href="#">ê³ ê°ì§€ì›</a>
      </nav>

        <div>
            <a href="../../index.html">í™ˆ</a>
        </div>

        <div>
            <a href="../company/company.html">íšŒì‚¬ì†Œê°œ</a>
        </div>

        <div>
            <a href="../product/product.html">ì œí’ˆì†Œê°œ</a>
        </div>
        
        <div>
            <a href="../school/school.html">ë‚©í’ˆí•™êµ ë¦¬ìŠ¤íŠ¸</a>
        </div>

        <div>
            <a href="../Gallery/Gallery.html">ê°¤ëŸ¬ë¦¬</a>
        </div>

        <div>
            <a href="../AS/AS.html">A/Sì‹ ì²­</a>
        </div>

        <div>
            <a href="#">ê³ ê°ì§€ì›</a>
        </div>

        <div class="login">
            <a href="#" onclick="showLogin()" id="login-link" class="login-item">
                <img src="../image/login.png" alt="ë¡œê·¸ì¸" class="login-icon"> ë¡œê·¸ì¸
            </a>
            <a href="#" onclick="logout()" id="logout-link" class="login-item" style="display:none;">
                <img src="../image/logout.png" alt="ë¡œê·¸ì•„ì›ƒ" class="login-icon"> ë¡œê·¸ì•„ì›ƒ
            </a>
  <a href="../staff/staff.html" class="employee-btn">
    <button class="employee-button" disabled>ì„ì§ì›</button>
            </a>
        </div>
     </header>

    <!-- ì—‘ì…€ ì—…ë¡œë“œ ë²„íŠ¼ (ê´€ë¦¬ìë§Œ í‘œì‹œ) - ë™ê·¸ë€ ì˜¤ë²„ë ˆì´ ë²„íŠ¼ -->
    <label for="excel-upload" class="excel-upload-btn" id="excel-upload-btn" style="display: none;" title="ì—‘ì…€ íŒŒì¼ ì²¨ë¶€">
        <input type="file" id="excel-upload" accept=".xlsx,.xls" onchange="handleExcelUpload(event)">
    </label>

    <!-- ì—‘ì…€ ë°ì´í„° í‘œì‹œ ì˜ì—­ -->
    <div class="excel-display-area" id="excel-display-area">
        <div class="read-only-notice">
            âš ï¸ ëª¨ë°”ì¼ì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ë°ìŠ¤í¬íƒ‘ ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”!
        </div>
        <div id="tabulator-table" style="display: none;"></div>
        <div id="excel-content">
            <p style="text-align: center; padding: 40px; color: #999;">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</p>
        </div>
    </div>

    <!-- íŒŒíŠ¸ë„ˆ ë¡œê³  (ì—‘ì…€ ì˜ì—­ ë°”ë¡œ ë‹¤ìŒì— ë°°ì¹˜) -->
    <div class="partner-logos" style="display: flex !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 1000 !important; clear: both !important; margin-top: 40px !important; margin-bottom: 20px !important; width: 100% !important; min-height: 100px !important; padding: 20px 20px !important; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important; border-top: 1px solid rgba(0, 0, 0, 0.05) !important; border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;">
        <a href="https://www.g2b.go.kr/" target="_blank">
            <img src="../image/logo1.png" alt="íŒŒíŠ¸ë„ˆ 1">
        </a>
        <a href="https://shop.g2b.go.kr/" target="_blank">
            <img src="../image/logo2.png" alt="íŒŒíŠ¸ë„ˆ 2">
        </a>
        <a href="https://hometax.go.kr/" target="_blank">
            <img src="../image/logo3.png" alt="íŒŒíŠ¸ë„ˆ 3">
        </a>
        <a href="https://www.smpp.go.kr" target="_blank">
            <img src="../image/logo4.png" alt="íŒŒíŠ¸ë„ˆ 4">
        </a>
        <a href="https://ecosq.or.kr/" target="_blank">
            <img src="../image/logo5.png" alt="íŒŒíŠ¸ë„ˆ 5">
        </a>
        <a href="https://www.sgic.co.kr/" target="_blank">
            <img src="../image/logo6.png" alt="íŒŒíŠ¸ë„ˆ 6">
        </a>
        <a href="https://si4n.nhis.or.kr/" target="_blank">
            <img src="../image/logo7.png" alt="íŒŒíŠ¸ë„ˆ 7">
        </a>
        <a href="https://www.4insure.or.kr/" target="_blank">
            <img src="../image/logo8.png" alt="íŒŒíŠ¸ë„ˆ 8">
        </a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const isLoggedIn = sessionStorage.getItem("loggedIn");
            if (isLoggedIn) {
                document.querySelector('.employee-button').disabled = false;
                document.getElementById('login-link').style.display = 'none';
                document.getElementById('logout-link').style.display = 'flex';
            }
            
            // ì„ì§ì› ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ í´ë¦­ ì´ë²¤íŠ¸ ë§‰ê¸°
            const employeeBtn = document.querySelector('.employee-btn');
            if (employeeBtn) {
                employeeBtn.addEventListener('click', function(e) {
                    const button = employeeBtn.querySelector('button');
                    if (button && button.disabled) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                });
            }
        });
    </script>

    <!-- ê³µí†µ ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="../js/auth.js"></script>

    <script>
document.addEventListener('DOMContentLoaded', function () {
  const burger = document.getElementById('hamburger');
  const drawer = document.getElementById('mobile-nav');
  const overlay = document.getElementById('overlay');
  if (!burger || !drawer || !overlay) return;

  let prevFocus = null;
  function setState(open) {
    burger.setAttribute('aria-expanded', String(open));
    burger.setAttribute('aria-label', open ? 'ë©”ë‰´ ë‹«ê¸°' : 'ë©”ë‰´ ì—´ê¸°');
    drawer.classList.toggle('open', open);
    document.body.classList.toggle('menu-open', open);
    overlay.classList.toggle('menu-open', open);
  }
  function openMenu() {
    const login = document.getElementById('login-container');
    if (login && login.style.display === 'block' && typeof hideLogin === 'function') hideLogin();
    prevFocus = document.activeElement;
    setState(true);
    const first = drawer.querySelector('a');
    if (first) first.focus();
  }
  function closeMenu() {
    setState(false);
    if (prevFocus && prevFocus.focus) prevFocus.focus();
    prevFocus = null;
  }
  function toggleMenu() {
    const isOpen = drawer.classList.contains('open');
    isOpen ? closeMenu() : openMenu();
  }

  burger.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    toggleMenu();
  });
  overlay.addEventListener('click', () => { if (drawer.classList.contains('open')) closeMenu(); });
  drawer.querySelectorAll('a').forEach(a => a.addEventListener('click', closeMenu));
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && drawer.classList.contains('open')) closeMenu(); });
  window.addEventListener('resize', () => { if (window.innerWidth > 1024 && drawer.classList.contains('open')) closeMenu(); });
});
    </script>

    <!-- íŒŒíŠ¸ë„ˆ ë¡œê³  ê°•ì œ í‘œì‹œ ìŠ¤í¬ë¦½íŠ¸ - ë¼ìš°í„° ì¬ì´ˆê¸°í™” í›„ì—ë„ ë³´í˜¸ -->
    <script>
        function ensurePartnerLogosVisible() {
            const partnerLogos = document.querySelectorAll('.partner-logos');
            partnerLogos.forEach(partnerLogo => {
                if (partnerLogo) {
                    // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ê°•ì œ ì ìš©
                    partnerLogo.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 1000 !important; clear: both !important; margin-top: 40px !important; width: 100% !important; min-height: 100px !important; padding: 20px 20px !important; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;';
                    
                    // ëª¨ë“  ë§í¬ì™€ ì´ë¯¸ì§€ë„ í™•ì¸
                    const links = partnerLogo.querySelectorAll('a');
                    links.forEach(link => {
                        link.style.display = 'flex';
                        link.style.visibility = 'visible';
                        link.style.opacity = '1';
                    });
                    
                    const images = partnerLogo.querySelectorAll('img');
                    images.forEach(img => {
                        img.style.display = 'block';
                        img.style.visibility = 'visible';
                        img.style.opacity = '1';
                    });
                    
                    console.log('íŒŒíŠ¸ë„ˆ ë¡œê³  ê°•ì œ í‘œì‹œ ì™„ë£Œ:', partnerLogo);
                }
            });
            
            if (partnerLogos.length === 0) {
                console.error('íŒŒíŠ¸ë„ˆ ë¡œê³  ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì¦‰ì‹œ ì‹¤í–‰
        ensurePartnerLogosVisible();
        
        document.addEventListener('DOMContentLoaded', function() {
            ensurePartnerLogosVisible();
            // DOMì´ ì¤€ë¹„ëœ í›„ íŒŒíŠ¸ë„ˆ ë¡œê³  ìœ„ì¹˜ í™•ì¸
            const partnerLogos = document.querySelectorAll('.partner-logos');
            console.log('íŒŒíŠ¸ë„ˆ ë¡œê³  ìš”ì†Œ ê°œìˆ˜:', partnerLogos.length);
            partnerLogos.forEach((logo, index) => {
                const rect = logo.getBoundingClientRect();
                console.log(`íŒŒíŠ¸ë„ˆ ë¡œê³  #${index + 1} ìœ„ì¹˜:`, {
                    top: rect.top,
                    left: rect.left,
                    width: rect.width,
                    height: rect.height,
                    visible: rect.width > 0 && rect.height > 0
                });
                const style = window.getComputedStyle(logo);
                console.log(`íŒŒíŠ¸ë„ˆ ë¡œê³  #${index + 1} ìŠ¤íƒ€ì¼:`, {
                    display: style.display,
                    visibility: style.visibility,
                    opacity: style.opacity,
                    zIndex: style.zIndex
                });
            });
        });
        
        window.addEventListener('load', ensurePartnerLogosVisible);
        
        // ë¼ìš°í„° ì¬ì´ˆê¸°í™” ì´ë²¤íŠ¸ ê°ì§€
        window.addEventListener('authStateRestored', ensurePartnerLogosVisible);
        
        // ì¶”ê°€ í™•ì¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
        setTimeout(ensurePartnerLogosVisible, 100);
        setTimeout(ensurePartnerLogosVisible, 500);
        setTimeout(ensurePartnerLogosVisible, 1000);
        setTimeout(ensurePartnerLogosVisible, 2000);
        
        // MutationObserverë¡œ íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ ì œê±°ë˜ê±°ë‚˜ ìˆ¨ê²¨ì§€ì§€ ì•Šë„ë¡ ê°ì‹œ
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    const target = mutation.target;
                    if (target.classList && target.classList.contains('partner-logos')) {
                        const style = window.getComputedStyle(target);
                        if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                            ensurePartnerLogosVisible();
                        }
                    }
                }
                if (mutation.type === 'childList') {
                    mutation.removedNodes.forEach(function(node) {
                        if (node.nodeType === 1 && node.classList && node.classList.contains('partner-logos')) {
                            console.warn('íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!');
                            // íŒŒíŠ¸ë„ˆ ë¡œê³ ê°€ ì œê±°ë˜ë©´ ë‹¤ì‹œ ì¶”ê°€
                            const footer = document.querySelector('footer');
                            if (footer && !document.querySelector('.partner-logos')) {
                                const newPartnerLogos = node.cloneNode(true);
                                footer.parentNode.insertBefore(newPartnerLogos, footer);
                                ensurePartnerLogosVisible();
                            }
                        }
                    });
                }
            });
        });
        
        // íŒŒíŠ¸ë„ˆ ë¡œê³  ê°ì‹œ ì‹œì‘
        document.addEventListener('DOMContentLoaded', function() {
            const partnerLogos = document.querySelectorAll('.partner-logos');
            partnerLogos.forEach(partnerLogo => {
                observer.observe(partnerLogo, {
                    attributes: true,
                    attributeFilter: ['style', 'class'],
                    childList: true,
                    subtree: true
                });
            });
        });
    </script>

    <div style="padding: 15px 20px 5px 20px; font-size: 10px; color: #bcbcbc; text-align: left; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">
      <p style="text-indent: 20px; margin: 12px 0 !important; line-height: 1.8 !important; word-break: break-word; overflow-wrap: break-word; white-space: normal;">1. ë³¸ í™ˆí˜ì´ì§€ëŠ” ë°ìŠ¤í¬íƒ‘ ë¸Œë¼ìš°ì € ë²„ì „ì— ìµœì í™” ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì›í™œí•œ ì‚¬ìš©ì„ ìœ„í•´ ë°ìŠ¤í¬íƒ‘ ë¸Œë¼ìš°ì € í™˜ê²½ìœ¼ë¡œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.</p>
      <p style="text-indent: 20px; margin: 12px 0 !important; line-height: 1.8 !important; word-break: break-word; overflow-wrap: break-word; white-space: normal;">2. í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜ëŠ” ì¡°ë‹¬ì²­ ë° ê³µê³µê¸°ê´€ ë‚©í’ˆ ì „ìš© ê°€êµ¬ë¥¼ ì „ë¬¸ìœ¼ë¡œ ì œì‘í•˜ëŠ” ê¸°ì—… ì…ë‹ˆë‹¤. ë³¸ í™ˆí˜ì´ì§€ì—ì„œ ì†Œê°œë˜ëŠ” ì œí’ˆë“¤ì€ ì¡°ë‹¬ì²­ ì¢…í•©ì‡¼í•‘ëª° íŒë§¤ ì „ìš©ì…ë‹ˆë‹¤.</p>
    </div>

    <footer>
        <p>Copyright Â© 2025 (ì£¼)í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ . | ë¬¸ì˜ : oa9500@empas.com | ì „í™” : 042-633-9500  |  A/S : 043-731-9511</p>
        <p class="footer-info">ì£¼ì‹íšŒì‚¬ í•˜ë‚˜ë¡œì˜¤ì—ì´í¼ë‹ˆì²˜ | ëŒ€í‘œì´ì‚¬ : ì •ì§„í¬, ì¥ì¸ë• | ì£¼ì†Œ : ëŒ€ì „ê´‘ì—­ì‹œ ëŒ€ë•êµ¬ ì˜¤ì •ë¡œ 41ë²ˆê¸¸ 12 | ì „í™” : 042-633-9500 | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ : 305-81-45158</p>
    </footer>

    <!-- ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ -->
    <div class="login-notice-modal" id="login-notice-modal">
        <div class="login-notice-content">
            <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
            <p>ë‚©í’ˆí•™êµ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì‹œë ¤ë©´ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <button onclick="closeLoginNotice(); showLogin();">ë¡œê·¸ì¸í•˜ê¸°</button>
        </div>
    </div>

    
    <script>
        // Firebase Storage ì´ˆê¸°í™”
        let storage = null;
        
        // Firebase Storage ì´ˆê¸°í™” í•¨ìˆ˜
        function initStorage() {
            if (typeof firebase !== 'undefined' && firebase.storage) {
                try {
                    storage = firebase.storage();
                    console.log('Firebase Storage ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('Firebase Storage ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                }
            } else {
                console.warn('Firebase Storage SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
        function checkUserPermission() {
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            if (loggedInUser) {
                try {
                    const userData = JSON.parse(loggedInUser);
                    // ê´€ë¦¬ìë§Œ ì—…ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
                    if (userData.isAdmin) {
                        const uploadBtn = document.getElementById('excel-upload-btn');
                        if (uploadBtn) {
                            uploadBtn.style.display = 'flex';
                        }
                    }
                    return true;
                } catch (e) {
                    console.error('ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', e);
                    return false;
                }
            }
            return false;
        }

        // DOM ìš”ì†Œ ìºì‹± (ì„±ëŠ¥ ìµœì í™”)
        let cachedLoginLink = null;
        let cachedLogoutLink = null;
        let cachedLoginModal = null;
        
        const getLoginLink = () => {
            if (!cachedLoginLink) cachedLoginLink = document.getElementById('login-link');
            return cachedLoginLink;
        };
        
        const getLogoutLink = () => {
            if (!cachedLogoutLink) cachedLogoutLink = document.getElementById('logout-link');
            return cachedLogoutLink;
        };
        
        const getLoginModal = () => {
            if (!cachedLoginModal) cachedLoginModal = document.getElementById('login-notice-modal');
            return cachedLoginModal;
        };
        
        // ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ (ìµœì í™”)
        const closeLoginModal = () => {
            const modal = getLoginModal();
            if (modal && modal.classList.contains('active')) {
                modal.classList.remove('active');
            }
        };
        
        // ê°„ë‹¨í•œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ì„±ëŠ¥ ìµœì í™”)
        const checkAuthState = () => {
            // 1. sessionStorage ìš°ì„  í™•ì¸ (ê°€ì¥ ë¹ ë¦„)
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            const loggedIn = sessionStorage.getItem('loggedIn');
            
            if (loggedInUser && loggedIn === "true") {
                // sessionStorageì— ë¡œê·¸ì¸ ì •ë³´ê°€ ìˆìœ¼ë©´ ë¡œê·¸ì¸ ìƒíƒœ
                // authListenerReady í™•ì¸ (ê°„ë‹¨í•˜ê²Œ)
                if (typeof window.authListenerReady !== 'undefined' && window.authListenerReady) {
                    return true; // ì™„ì „íˆ ì´ˆê¸°í™”ë¨
                }
                return null; // ì•„ì§ ì´ˆê¸°í™” ì¤‘
            }
            
            // 2. authListenerReadyê°€ trueì´ê³  sessionStorageì— ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ
            if (typeof window.authListenerReady !== 'undefined' && window.authListenerReady) {
                return false; // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
            }
            
            return null; // ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ
        };
        
        // ë¡œê·¸ì¸ ì´ˆê¸°í™” ì™„ë£Œ ëŒ€ê¸° í•¨ìˆ˜ (ìµœì í™”)
        async function waitForAuthInit(maxWaitTime = 3000) {
            return new Promise((resolve) => {
                let resolved = false;
                const startTime = Date.now();
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: authStateRestored ì´ë²¤íŠ¸ ê°ì§€ (ê°€ì¥ ë¹ ë¥¸ ë°©ë²•)
                const handleAuthRestored = () => {
                    if (resolved) return;
                    
                    // ì§§ì€ ëŒ€ê¸° í›„ í™•ì¸ (UI ì—…ë°ì´íŠ¸ ì‹œê°„)
                    setTimeout(() => {
                        if (resolved) return;
                        const state = checkAuthState();
                        if (state !== null) {
                            resolved = true;
                            window.removeEventListener('authStateRestored', handleAuthRestored);
                            
                            // ë¡œê·¸ì¸ ìƒíƒœë©´ ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸°
                            if (state === true) {
                                closeLoginModal();
                            }
                            
                            resolve(state);
                        }
                    }, 200); // 200msë¡œ ë‹¨ì¶•
                };
                
                window.addEventListener('authStateRestored', handleAuthRestored);
                
                // ì¦‰ì‹œ í™•ì¸ (ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆì„ ìˆ˜ ìˆìŒ)
                const immediateState = checkAuthState();
                if (immediateState !== null) {
                    resolved = true;
                    window.removeEventListener('authStateRestored', handleAuthRestored);
                    if (immediateState === true) {
                        closeLoginModal();
                    }
                    resolve(immediateState);
                    return;
                }
                
                // í´ë§ ë°©ì‹ (ê°„ê²© ì¦ê°€ë¡œ ì„±ëŠ¥ ê°œì„ )
                const pollInterval = setInterval(() => {
                    if (resolved) {
                        clearInterval(pollInterval);
                        return;
                    }
                    
                    const state = checkAuthState();
                    if (state !== null) {
                        resolved = true;
                        window.removeEventListener('authStateRestored', handleAuthRestored);
                        clearInterval(pollInterval);
                        
                        // ë¡œê·¸ì¸ ìƒíƒœë©´ ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸°
                        if (state === true) {
                            closeLoginModal();
                        }
                        
                        resolve(state);
                        return;
                    }
                    
                    // íƒ€ì„ì•„ì›ƒ ì²´í¬
                    if (Date.now() - startTime >= maxWaitTime) {
                        if (!resolved) {
                            resolved = true;
                            window.removeEventListener('authStateRestored', handleAuthRestored);
                            clearInterval(pollInterval);
                            
                            // íƒ€ì„ì•„ì›ƒ: sessionStorage í™•ì¸
                            const loggedInUser = sessionStorage.getItem('loggedInUser');
                            const loggedIn = sessionStorage.getItem('loggedIn');
                            const finalResult = (loggedInUser && loggedIn === "true");
                            resolve(finalResult);
                        }
                    }
                }, 500); // 500msë¡œ ì¦ê°€ (ì„±ëŠ¥ ê°œì„ )
            });
        }

        // ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        async function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                event.target.value = '';
                return;
            }

            if (!file.name.match(/\.(xlsx|xls)$/)) {
                alert('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }

            // Storage ì´ˆê¸°í™” í™•ì¸
            if (!storage) {
                initStorage();
                if (!storage) {
                    alert('Firebase Storageê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    event.target.value = '';
                    return;
                }
            }

            try {
                // Firebase Storageì— ì—…ë¡œë“œ
                const storageRef = storage.ref();
                const fileRef = storageRef.child('school-list/school-list.xlsx');
                
                // ì—…ë¡œë“œ ì‹œì‘ ì „ ë¡œë”© ë©”ì‹œì§€
                const excelContent = document.getElementById('excel-content');
                const tabulatorTable = document.getElementById('tabulator-table');
                if (excelContent) {
                    excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">íŒŒì¼ ì—…ë¡œë“œ ì¤‘...</p>';
                    excelContent.style.display = 'block';
                }
                if (tabulatorTable) {
                    tabulatorTable.style.display = 'none';
                }
                
                const uploadTask = fileRef.put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('ì—…ë¡œë“œ ì§„í–‰ë¥ : ' + progress + '%');
                        if (excelContent) {
                            excelContent.innerHTML = `<p style="text-align: center; padding: 40px; color: #666;">íŒŒì¼ ì—…ë¡œë“œ ì¤‘... ${Math.round(progress)}%</p>`;
                            excelContent.style.display = 'block';
                        }
                    },
                    (error) => {
                        console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                        event.target.value = '';
                        let errorMsg = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                        if (error.code === 'storage/unauthorized') {
                            errorMsg = 'ì—…ë¡œë“œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                        } else if (error.code === 'storage/quota-exceeded') {
                            errorMsg = 'ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.';
                        } else if (error.code === 'storage/canceled') {
                            errorMsg = 'ì—…ë¡œë“œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                        }
                        alert(errorMsg);
                        if (excelContent) {
                            excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ì—…ë¡œë“œ ì‹¤íŒ¨</p>';
                            excelContent.style.display = 'block';
                        }
                        const tabulatorTable = document.getElementById('tabulator-table');
                        if (tabulatorTable) {
                            tabulatorTable.style.display = 'none';
                        }
                    },
                    async () => {
                        try {
                            // ì—…ë¡œë“œ ì™„ë£Œ
                            console.log('ì—…ë¡œë“œ ì™„ë£Œ');
                            // íŒŒì¼ ì½ê¸° ë° í‘œì‹œ
                            await loadExcelFile();
                            // íŒŒì¼ input ì´ˆê¸°í™”
                            event.target.value = '';
                        } catch (error) {
                            console.error('íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                            alert('íŒŒì¼ ì—…ë¡œë“œëŠ” ì™„ë£Œë˜ì—ˆì§€ë§Œ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            event.target.value = '';
                        }
                    }
                );
            } catch (error) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                event.target.value = '';
                alert('íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                const excelContent = document.getElementById('excel-content');
                const tabulatorTable = document.getElementById('tabulator-table');
                if (excelContent) {
                    excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ì—…ë¡œë“œ ì‹¤íŒ¨</p>';
                    excelContent.style.display = 'block';
                }
                if (tabulatorTable) {
                    tabulatorTable.style.display = 'none';
                }
            }
        }

        // Firebase Storageì—ì„œ ì—‘ì…€ íŒŒì¼ ë¡œë“œ
        async function loadExcelFile() {
            const excelContent = document.getElementById('excel-content');
            
            try {
                // Storage ì´ˆê¸°í™” í™•ì¸
                if (!storage) {
                    initStorage();
                    if (!storage) {
                        console.warn('Firebase Storageê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        if (excelContent) {
                            excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">Firebase Storage ì´ˆê¸°í™” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
                        }
                        return;
                    }
                }

                // SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof XLSX === 'undefined') {
                    console.error('SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    if (excelContent) {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ì—‘ì…€ íŒŒì¼ ì½ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
                        excelContent.style.display = 'block';
                    }
                    const tabulatorTable = document.getElementById('tabulator-table');
                    if (tabulatorTable) {
                        tabulatorTable.style.display = 'none';
                    }
                    return;
                }

                // Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof Tabulator === 'undefined') {
                    console.error('Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    if (excelContent) {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë·° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
                        excelContent.style.display = 'block';
                    }
                    const tabulatorTable = document.getElementById('tabulator-table');
                    if (tabulatorTable) {
                        tabulatorTable.style.display = 'none';
                    }
                    return;
                }

                const storageRef = storage.ref();
                const fileRef = storageRef.child('school-list/school-list.xlsx');
                
                // Firebase Storage SDKë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ë°”ì´íŠ¸ ë‹¤ìš´ë¡œë“œ
                let arrayBuffer;
                try {
                    // getDownloadURL()ë¡œ URL ê°€ì ¸ì˜¤ê¸°
                    const url = await fileRef.getDownloadURL();
                    console.log('ë‹¤ìš´ë¡œë“œ URL íšë“:', url);
                    
                    // ì´ë¯¸ì§€ë‚˜ íŒŒì¼ì„ ì§ì ‘ ë¡œë“œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ CORS ë¬¸ì œ ìš°íšŒ
                    // Firebase Storage URLì€ ì¸ì¦ëœ ì‚¬ìš©ìì—ê²ŒëŠ” CORSê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•¨
                    // í•˜ì§€ë§Œ ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” CORS ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ
                    // Firebase Storage SDKì˜ ì§ì ‘ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì‚¬ìš©
                    
                    // ë°©ë²• 1: Blob URLì„ í†µí•œ ê°„ì ‘ ë‹¤ìš´ë¡œë“œ
                    try {
                        // fetch with no-corsëŠ” ì‘ë‹µì„ ì½ì„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì‚¬ìš© ë¶ˆê°€
                        // ëŒ€ì‹  Firebase Storageì˜ ì§ì ‘ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì‚¬ìš©
                        
                        // compat ë²„ì „ì—ì„œëŠ” getBytes()ê°€ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
                        // getDownloadURL() í›„ fetchë¥¼ ì‚¬ìš©í•˜ë˜, CORS ì—ëŸ¬ ì²˜ë¦¬
                        const response = await fetch(url, {
                            method: 'GET',
                            mode: 'cors',
                            credentials: 'omit',
                            headers: {
                                'Accept': 'application/octet-stream'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                        }
                        
                        arrayBuffer = await response.arrayBuffer();
                    } catch (fetchError) {
                        console.error('fetch ì‹¤íŒ¨:', fetchError);
                        // CORS ì˜¤ë¥˜ì¸ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
                        if (fetchError.message && (
                            fetchError.message.includes('CORS') || 
                            fetchError.message.includes('Access-Control-Allow-Origin') ||
                            fetchError.message.includes('Failed to fetch') ||
                            fetchError.name === 'TypeError'
                        )) {
                            // Firebase Storage CORS ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš°
                            throw new Error('CORS ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Firebase Consoleì—ì„œ Storageì˜ CORS ì„¤ì •ì„ í™•ì¸í•˜ê±°ë‚˜, ë°°í¬ëœ í™˜ê²½ì—ì„œ ì ‘ì†í•´ì£¼ì„¸ìš”.');
                        }
                        throw fetchError;
                    }
                } catch (downloadError) {
                    console.error('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', downloadError);
                    throw downloadError;
                }
                
                if (!arrayBuffer || arrayBuffer.byteLength === 0) {
                    throw new Error('ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                }
                
                // SheetJSë¡œ ì—‘ì…€ íŒŒì¼ ì½ê¸°
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) {
                    throw new Error('ì—‘ì…€ íŒŒì¼ì— ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ì²« ë²ˆì§¸ ì‹œíŠ¸ ê°€ì ¸ì˜¤ê¸°
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                if (!worksheet) {
                    throw new Error('ì‹œíŠ¸ë¥¼ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // JSONìœ¼ë¡œ ë³€í™˜ (ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©)
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1,  // ë°°ì—´ í˜•íƒœë¡œ ë³€í™˜
                    defval: ''   // ë¹ˆ ì…€ì€ ë¹ˆ ë¬¸ìì—´ë¡œ
                });
                
                if (!jsonData || jsonData.length === 0) {
                    throw new Error('ì—‘ì…€ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                }
                
                // ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©
                const headers = jsonData[0];
                if (!headers || headers.length === 0) {
                    throw new Error('ì—‘ì…€ íŒŒì¼ì— í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ë°ì´í„° í–‰ ì¶”ì¶œ (ì²« ë²ˆì§¸ í–‰ ì œì™¸)
                const dataRows = jsonData.slice(1);
                
                // ë¹ˆ í–‰ í•„í„°ë§ (ëª¨ë“  ì…€ì´ ë¹„ì–´ìˆëŠ” í–‰ ì œê±°)
                const filteredRows = dataRows.filter(row => {
                    return row && row.some(cell => cell !== undefined && cell !== null && cell.toString().trim() !== '');
                });
                
                if (filteredRows.length === 0) {
                    throw new Error('ì—‘ì…€ íŒŒì¼ì— ë°ì´í„° í–‰ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                console.log('ì—‘ì…€ ë°ì´í„° ë¡œë“œ:', filteredRows.length, 'í–‰');
                
                // Tabulatorìš© ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const tabulatorData = filteredRows.map((row, index) => {
                    const rowObj = { id: index + 1 }; // ê³ ìœ  ID ì¶”ê°€
                    headers.forEach((header, colIndex) => {
                        // í—¤ë”ê°€ ë¹ˆ ë¬¸ìì—´ì´ë©´ "Column" + ì¸ë±ìŠ¤ë¡œ ì„¤ì •
                        const columnName = header && header.toString().trim() 
                            ? header.toString().trim() 
                            : `Column${colIndex + 1}`;
                        rowObj[columnName] = row[colIndex] !== undefined && row[colIndex] !== null 
                            ? row[colIndex].toString() 
                            : '';
                    });
                    return rowObj;
                });
                
                console.log('Tabulator ë°ì´í„° ë³€í™˜ ì™„ë£Œ:', tabulatorData.length, 'í–‰');
                
                // ëª¨ë°”ì¼ ì—¬ë¶€ í™•ì¸
                const isMobile = window.innerWidth <= 1024;
                
                // Tabulator ì»¬ëŸ¼ ì •ì˜ ìƒì„±
                const columns = headers.map((header, index) => {
                    const columnName = header && header.toString().trim() 
                        ? header.toString().trim() 
                        : `Column${index + 1}`;
                    return {
                        title: columnName,
                        field: columnName,
                        headerFilter: isMobile ? false : "input",  // ëª¨ë°”ì¼ì—ì„œëŠ” í•„í„° ë¹„í™œì„±í™”
                        headerSort: true,        // ì •ë ¬ ê¸°ëŠ¥ í™œì„±í™”
                        sorter: "string",        // ë¬¸ìì—´ ì •ë ¬
                        width: 150,              // ê³ ì • ë„ˆë¹„ ì„¤ì • (ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ë™ì¼)
                        minWidth: 120,           // ìµœì†Œ ë„ˆë¹„ ë³´ì¥ (ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
                        maxWidth: undefined,     // ìµœëŒ€ ë„ˆë¹„ ì œí•œ ì—†ìŒ
                        resizable: !isMobile,          // ëª¨ë°”ì¼ì—ì„œëŠ” ì»¬ëŸ¼ í¬ê¸° ì¡°ì ˆ ë¹„í™œì„±í™”
                        visible: true,           // í•­ìƒ í‘œì‹œ
                        formatter: undefined  // ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ (ìŠ¤ì™€ì´í”„ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡)
                    };
                });
                
                // Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof Tabulator === 'undefined') {
                    throw new Error('Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // Tabulator í…Œì´ë¸” ìƒì„±
                const tabulatorTable = document.getElementById('tabulator-table');
                if (!tabulatorTable) {
                    throw new Error('Tabulator í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ê¸°ì¡´ í…Œì´ë¸”ì´ ìˆìœ¼ë©´ ì œê±°
                if (window.schoolTable) {
                    try {
                        // ê¸°ì¡´ observer ì •ë¦¬
                        if (window.schoolTableObserver) {
                            window.schoolTableObserver.disconnect();
                            window.schoolTableObserver = null;
                        }
                        window.schoolTable.destroy();
                    } catch (e) {
                        console.warn('ê¸°ì¡´ í…Œì´ë¸” ì œê±° ì¤‘ ì˜¤ë¥˜:', e);
                    }
                }
                
                console.log('Tabulator í…Œì´ë¸” ìƒì„± ì‹œì‘:', tabulatorData.length, 'í–‰', columns.length, 'ì»¬ëŸ¼');
                
                // ìƒˆ Tabulator ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                try {
                    window.schoolTable = new Tabulator("#tabulator-table", {
                        data: tabulatorData,
                        columns: columns,
                        layout: "fitColumns",    // ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ fitColumns ì‚¬ìš© (ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
                        pagination: true,        // í˜ì´ì§€ë„¤ì´ì…˜ í™œì„±í™”
                        paginationSize: isMobile ? 20 : 50,       // ëª¨ë°”ì¼ì—ì„œëŠ” í˜ì´ì§€ë‹¹ 20ê°œ, ë°ìŠ¤í¬í†±ì€ 50ê°œ
                        paginationSizeSelector: isMobile ? [10, 20, 30, 50] : [25, 50, 100, 200], // ëª¨ë°”ì¼ ìµœì í™” ì˜µì…˜
                        paginationCounter: "rows", // í–‰ ìˆ˜ í‘œì‹œ
                        movableColumns: !isMobile,    // ëª¨ë°”ì¼ì—ì„œëŠ” ì»¬ëŸ¼ ì´ë™ ë¹„í™œì„±í™”
                        resizableColumns: !isMobile,   // ëª¨ë°”ì¼ì—ì„œëŠ” ì»¬ëŸ¼ í¬ê¸° ì¡°ì ˆ ë¹„í™œì„±í™”
                        tooltips: true,           // íˆ´íŒ í‘œì‹œ
                        placeholder: "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
                        height: isMobile 
                            ? "600px"  // ëª¨ë°”ì¼: ì¶©ë¶„í•œ ë†’ì´ë¡œ ì„¤ì •í•˜ì—¬ ë§ì€ í–‰ í‘œì‹œ
                            : (tabulatorData.length > 0 ? "600px" : "400px"),  // ë°ìŠ¤í¬í†±: ê¸°ì¡´ ë†’ì´
                        minHeight: isMobile ? "500px" : "400px",        // ëª¨ë°”ì¼ ìµœì†Œ ë†’ì´ ì¦ê°€
                        responsiveLayout: false, // ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì™„ì „íˆ ë¹„í™œì„±í™” (ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
                        rowHeight: isMobile ? 36 : undefined,  // ëª¨ë°”ì¼ì—ì„œ í–‰ ë†’ì´ ëª…ì‹œì  ì„¤ì • (36px)
                        virtualDom: true,  // ê°€ìƒ DOM ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
                        virtualDomBuffer: 300,  // ë²„í¼ í¬ê¸° ì„¤ì •
                        autoResize: false,  // ìë™ í¬ê¸° ì¡°ì ˆ ë¹„í™œì„±í™” (ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
                        initialSort: [            // ì´ˆê¸° ì •ë ¬ ì„¤ì •
                            {column: "id", dir: "asc"}
                        ],
                        // ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™”
                        selectable: false,        // ì„ íƒ ë¹„í™œì„±í™” (ëª¨ë°”ì¼ì—ì„œ ì‹¤ìˆ˜ ë°©ì§€)
                        selectableRangeMode: "click"
                    });
                    
                    console.log('Tabulator í…Œì´ë¸” ìƒì„± ì™„ë£Œ');
                    
                    // excel-content ì˜ì—­ ìˆ¨ê¸°ê¸°
                    if (excelContent) {
                        excelContent.style.display = 'none';
                    }
                    
                    // tabulator-table ì˜ì—­ í‘œì‹œ
                    tabulatorTable.style.display = 'block';
                    
                    // í…Œì´ë¸”ì´ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸ ë° ì»¬ëŸ¼ ê°•ì œ í‘œì‹œ
                    setTimeout(() => {
                        const tableElement = tabulatorTable.querySelector('.tabulator-table');
                        if (!tableElement) {
                            console.warn('Tabulator í…Œì´ë¸”ì´ ë Œë”ë§ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        } else {
                            console.log('Tabulator í…Œì´ë¸” ë Œë”ë§ í™•ì¸ë¨');
                            
                            // ëª¨ë“  ì»¬ëŸ¼ì´ í•­ìƒ í‘œì‹œë˜ë„ë¡ ê°•ì œ
                            const allCols = tabulatorTable.querySelectorAll('.tabulator-col');
                            allCols.forEach(col => {
                                col.style.display = 'table-cell';
                                col.style.visibility = 'visible';
                                col.style.opacity = '1';
                            });
                            
                            // ëª¨ë“  ì…€ì´ í•­ìƒ í‘œì‹œë˜ë„ë¡ ê°•ì œ
                            const allCells = tabulatorTable.querySelectorAll('.tabulator-cell');
                            allCells.forEach(cell => {
                                cell.style.display = 'table-cell';
                                cell.style.visibility = 'visible';
                            });
                            
                            // ëª¨ë“  í–‰ì´ í•­ìƒ í‘œì‹œë˜ë„ë¡ ê°•ì œ
                            const allRows = tabulatorTable.querySelectorAll('.tabulator-row');
                            allRows.forEach(row => {
                                row.style.display = 'table-row';
                                row.style.visibility = 'visible';
                            });
                            
                            console.log('ëª¨ë“  ì»¬ëŸ¼/í–‰ ê°•ì œ í‘œì‹œ ì™„ë£Œ:', allCols.length, 'ì»¬ëŸ¼', allRows.length, 'í–‰');
                        }
                    }, 100);
                    
                    // window resize ì´ë²¤íŠ¸ì—ì„œ í…Œì´ë¸”ì´ ìë™ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ ë§‰ê¸°
                    let resizeTimeout;
                    const originalResize = window.schoolTable.redraw;
                    window.schoolTable.redraw = function() {
                        // redraw í˜¸ì¶œ ì‹œ ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡ ë³´í˜¸
                        const result = originalResize.call(this);
                        
                        // redraw í›„ ëª¨ë“  ì»¬ëŸ¼ì´ í‘œì‹œë˜ë„ë¡ ê°•ì œ
                        setTimeout(() => {
                            const allCols = tabulatorTable.querySelectorAll('.tabulator-col');
                            allCols.forEach(col => {
                                col.style.display = 'table-cell';
                                col.style.visibility = 'visible';
                                col.style.opacity = '1';
                            });
                        }, 50);
                        
                        return result;
                    };
                    
                    // window resize ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (í…Œì´ë¸”ì´ ìë™ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•Šë„ë¡)
                    window.addEventListener('resize', function() {
                        clearTimeout(resizeTimeout);
                        resizeTimeout = setTimeout(() => {
                            // resize í›„ ëª¨ë“  ì»¬ëŸ¼ì´ í‘œì‹œë˜ë„ë¡ ê°•ì œ
                            if (window.schoolTable && tabulatorTable) {
                                const allCols = tabulatorTable.querySelectorAll('.tabulator-col');
                                allCols.forEach(col => {
                                    col.style.display = 'table-cell';
                                    col.style.visibility = 'visible';
                                    col.style.opacity = '1';
                                });
                                
                                const allCells = tabulatorTable.querySelectorAll('.tabulator-cell');
                                allCells.forEach(cell => {
                                    cell.style.display = 'table-cell';
                                    cell.style.visibility = 'visible';
                                });
                                
                                const allRows = tabulatorTable.querySelectorAll('.tabulator-row');
                                allRows.forEach(row => {
                                    row.style.display = 'table-row';
                                    row.style.visibility = 'visible';
                                });
                            }
                        }, 100);
                    });
                    
                    // MutationObserverë¡œ DOM ë³€ê²½ ê°ì‹œí•˜ì—¬ ì»¬ëŸ¼ì´ ì‚¬ë¼ì§€ë©´ ë‹¤ì‹œ í‘œì‹œ
                    const observer = new MutationObserver(function(mutations) {
                        if (!window.schoolTable || !tabulatorTable) return;
                        
                        let needsFix = false;
                        const allCols = tabulatorTable.querySelectorAll('.tabulator-col');
                        allCols.forEach(col => {
                            const style = window.getComputedStyle(col);
                            if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                                col.style.display = 'table-cell';
                                col.style.visibility = 'visible';
                                col.style.opacity = '1';
                                needsFix = true;
                            }
                        });
                        
                        const allCells = tabulatorTable.querySelectorAll('.tabulator-cell');
                        allCells.forEach(cell => {
                            const style = window.getComputedStyle(cell);
                            if (style.display === 'none' || style.visibility === 'hidden') {
                                cell.style.display = 'table-cell';
                                cell.style.visibility = 'visible';
                                needsFix = true;
                            }
                        });
                        
                        const allRows = tabulatorTable.querySelectorAll('.tabulator-row');
                        allRows.forEach(row => {
                            const style = window.getComputedStyle(row);
                            if (style.display === 'none' || style.visibility === 'hidden') {
                                row.style.display = 'table-row';
                                row.style.visibility = 'visible';
                                needsFix = true;
                            }
                        });
                        
                        if (needsFix) {
                            console.log('ì»¬ëŸ¼/í–‰ì´ ì‚¬ë¼ì§„ ê²ƒì„ ê°ì§€í•˜ì—¬ ë‹¤ì‹œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.');
                        }
                    });
                    
                    // í…Œì´ë¸” ì»¨í…Œì´ë„ˆì˜ ë³€ê²½ì‚¬í•­ ê°ì‹œ
                    if (tabulatorTable) {
                        observer.observe(tabulatorTable, {
                            childList: true,
                            subtree: true,
                            attributes: true,
                            attributeFilter: ['style', 'class']
                        });
                    }
                    
                    // í…Œì´ë¸”ì´ ì œê±°ë  ë•Œ observer ì •ë¦¬
                    window.schoolTableObserver = observer;
                    
                } catch (tabulatorError) {
                    console.error('Tabulator ì´ˆê¸°í™” ì˜¤ë¥˜:', tabulatorError);
                    throw new Error('Tabulator í…Œì´ë¸” ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + tabulatorError.message);
                }
                } catch (error) {
                console.error('ì—‘ì…€ íŒŒì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', error.stack);
                
                const tabulatorTable = document.getElementById('tabulator-table');
                if (tabulatorTable) {
                    tabulatorTable.style.display = 'none';
                }
                
                if (excelContent) {
                    excelContent.style.display = 'block';
                    
                    if (error.code === 'storage/object-not-found' || 
                        error.code === 'storage/unauthorized' ||
                        error.message?.includes('object-not-found') ||
                        error.message?.includes('not found')) {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">ì—‘ì…€ íŒŒì¼ì´ ì•„ì§ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ê´€ë¦¬ìê°€ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</p>';
                    } else if (error.code === 'storage/unauthorized') {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">íŒŒì¼ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.<br>ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                    } else if (error.message && (
                        error.message.includes('CORS') || 
                        error.message.includes('Access-Control-Allow-Origin') ||
                        error.message.includes('Failed to fetch') ||
                        error.name === 'TypeError'
                    )) {
                        // ë°°í¬ í™˜ê²½ì¸ì§€ í™•ì¸
                        const isLocalhost = window.location.hostname === 'localhost' || 
                                          window.location.hostname === '127.0.0.1' ||
                                          window.location.protocol === 'file:';
                        
                        if (isLocalhost) {
                            excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">CORS ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br><br>ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” Firebase Storageì˜ CORS ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë°°í¬ëœ í™˜ê²½ì—ì„œ ì ‘ì†í•˜ì‹œë©´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.<br><br>ë˜ëŠ” Firebase Consoleì—ì„œ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.</p>';
                        } else {
                            excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">CORS ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br><br>Firebase Storageì˜ CORS ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ <code>Firebase_Storage_CORS_ì„¤ì •_ê°€ì´ë“œ.md</code> íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ CORSë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>';
                        }
                    } else if (error.message && error.message.includes('Tabulator')) {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë·° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì˜¤ë¥˜: ' + error.message + '<br><br>ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
                    } else {
                        excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ì—‘ì…€ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì˜¤ë¥˜: ' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '<br><br>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ ì—´ì–´ ìƒì„¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
                    }
                }
            }
        }

        // ì „ì—­: ë¡œê·¸ì¸ ìƒíƒœ ë³µì› ì‹œ ì•ˆë‚´ ëª¨ë‹¬ ìë™ ë‹«ê¸° (ìµœì í™”)
        function setupAuthStateListener() {
            if (window.schoolAuthStateListenerSetup) {
                return; // ì´ë¯¸ ì„¤ì •ë¨
            }
            
            window.schoolAuthStateListenerSetup = true;
            
            // authStateRestored ì´ë²¤íŠ¸ ê°ì§€ (ê°„ë‹¨í•˜ê²Œ)
            window.addEventListener('authStateRestored', function(event) {
                // ì§§ì€ ëŒ€ê¸° í›„ í™•ì¸
                setTimeout(() => {
                    const loggedInUser = sessionStorage.getItem('loggedInUser');
                    const loggedIn = sessionStorage.getItem('loggedIn');
                    
                    if (loggedInUser && loggedIn === "true") {
                        closeLoginModal();
                    }
                }, 200); // 200msë¡œ ë‹¨ì¶•
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì„¤ì •
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupAuthStateListener);
        } else {
            setupAuthStateListener();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
            if (typeof Tabulator === 'undefined') {
                console.error('Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                const excelContent = document.getElementById('excel-content');
                if (excelContent) {
                    excelContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #dc3545;">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë·° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
                    excelContent.style.display = 'block';
                }
                return;
            }
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •: Tabulator í…Œì´ë¸” ìˆ¨ê¸°ê¸°, excel-content í‘œì‹œ
            const tabulatorTable = document.getElementById('tabulator-table');
            const excelContent = document.getElementById('excel-content');
            if (tabulatorTable) {
                tabulatorTable.style.display = 'none';
            }
            if (excelContent) {
                excelContent.style.display = 'block';
            }
            
            // Firebase Storage ì´ˆê¸°í™”
            initStorage();
            
            // ë¡œê·¸ì¸ ì´ˆê¸°í™” ì™„ë£Œ ëŒ€ê¸° í›„ ìƒíƒœ í™•ì¸ (ìµœì í™”: 3ì´ˆë¡œ ë‹¨ì¶•)
            waitForAuthInit(3000).then(isLoggedIn => {
                // ì‚¬ìš©ì ê¶Œí•œ í™•ì¸ (ì—…ë¡œë“œ ë²„íŠ¼ í‘œì‹œìš©)
                checkUserPermission();
                
                const modal = getLoginModal();
                
                if (!isLoggedIn) {
                    // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ì•ˆë‚´ ëª¨ë‹¬ í‘œì‹œ
                    if (modal) {
                        modal.classList.add('active');
                    }
                    // ì—‘ì…€ í‘œì‹œ ì˜ì—­ ìˆ¨ê¸°ê¸°
                    const excelArea = document.getElementById('excel-display-area');
                    if (excelArea) {
                        excelArea.style.display = 'none';
                    }
                } else {
                    // ë¡œê·¸ì¸í•œ ê²½ìš° ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸° (í˜¹ì‹œ ì—´ë ¤ìˆë‹¤ë©´)
                    if (modal && modal.classList.contains('active')) {
                        modal.classList.remove('active');
                    }
                    // ì—‘ì…€ íŒŒì¼ ë¡œë“œ ë° í‘œì‹œ
                    loadExcelFile();
                }
            }).catch(error => {
                console.error('[School] ë¡œê·¸ì¸ ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ sessionStorage í™•ì¸
                const isLoggedIn = checkUserPermission();
                const modal = getLoginModal();
                
                if (!isLoggedIn) {
                    if (modal) {
                        modal.classList.add('active');
                    }
                    const excelArea = document.getElementById('excel-display-area');
                    if (excelArea) {
                        excelArea.style.display = 'none';
                    }
                } else {
                    // ë¡œê·¸ì¸í•œ ê²½ìš° ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸°
                    if (modal && modal.classList.contains('active')) {
                        modal.classList.remove('active');
                    }
                    loadExcelFile();
                }
            });
        });

        // ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸° (ìµœì í™”)
        function closeLoginNotice() {
            const modal = getLoginModal();
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(e) {
            const modal = getLoginModal();
            if (modal && modal.classList.contains('active')) {
                // í´ë¦­ëœ ìš”ì†Œê°€ ëª¨ë‹¬ ë°°ê²½ì´ì§€ ì½˜í…ì¸ ê°€ ì•„ë‹ ë•Œë§Œ ë‹«ê¸°
                if (e.target === modal) {
                    closeLoginNotice();
                }
            }
        });

        // ESC í‚¤ë¡œ ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLoginNotice();
            }
        });
    </script>
    
    <!-- ì¸ë±ìŠ¤ í˜ì´ì§€ë¡œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ -->
    <script>
        // school.htmlì— ì§ì ‘ ì ‘ê·¼í•˜ë©´ index.html#/schoolë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (window.location.pathname.includes('school.html')) {
            window.location.replace('../../index.html#/school');
        }
    </script>
    
</body>
</html>
